export default {
    state: {
        products: [
            {
                id: 3,
                article: 102935,
                name: 'Женская кофта 3',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/300/454_700_2/BAS-10105_300_20.jpg?cdn=1627901282',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/300/454_700_2/BAS-10105_300_20.jpg?cdn=1627901282', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/300/454_700_2/BAS-10105_300_20.jpg?cdn=1627901282', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/300/454_700_2/BAS-10105_300_20.jpg?cdn=1627901282'],
                colors:[{id: 1, color: '000'}, {id:2, color: 'fff'}, {id:3, color: 'ff0000'}, {id:4, color:'808080'}],
                sizes: ['XL', 'L', 'S'],
                specifications: '62% акрил, 86% полиэстер, 33% шерсть, 4% эластан',
                price:3000,
                hit: true,
                type: 'w',
                favorite: false
            },
            {
                id: 1,
                article: 102561,
                name: 'Женская кофта 1',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/101/454_700_2/BAS-10104_101_20.jpg?cdn=1627393262',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/101/454_700_2/BAS-10104_101_20.jpg?cdn=1627393262', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/101/454_700_2/BAS-10104_101_20.jpg?cdn=1627393262', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/101/454_700_2/BAS-10104_101_20.jpg?cdn=1627393262'],
                colors:[{id: 1, color: '000'}, {id:2, color: 'fff'}, {id:3, color: 'ff0000'}, {id:4, color:'808080'}],
                sizes: ['M', 'L', 'S', 'XL'],
                specifications: '38% акрил, 24% полиэстер, 15% шерсть, 14% эластан',
                price:1000,
                hit: false,
                type: 'w',
                favorite: false
            },
            {
                id: 6,
                article: 984232,
                name: 'Женская кофта 6',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/409/454_700_2/BAS-10106_409_20.jpg?cdn=1627369501',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/409/454_700_2/BAS-10106_409_20.jpg?cdn=1627369501', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/409/454_700_2/BAS-10106_409_20.jpg?cdn=1627369501', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/409/454_700_2/BAS-10106_409_20.jpg?cdn=1627369501'],
                colors:[{id: 5, color: '000'}, {id:6, color: 'ff0000'}],
                sizes: ['M', 'L', 'S'],
                specifications: '36% акрил, 2% полиэстер, 79% шерсть, 4% эластан',
                price:6000,
                hit: true,
                type: 'w',
                favorite: false
            },
            {
                id: 4,
                article: 102123,
                name: 'Женская кофта 4',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/211/454_700_2/BAS-10105_211_20.jpg?cdn=1627393262',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/211/454_700_2/BAS-10105_211_20.jpg?cdn=1627393262', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/211/454_700_2/BAS-10105_211_20.jpg?cdn=1627393262', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/211/454_700_2/BAS-10105_211_20.jpg?cdn=1627393262'],
                colors:[{id: 1, color: '000'}, {id:2, color: 'fff'}, {id:3, color: 'ff0000'}, {id:4, color:'808080'}],
                sizes: ['L', 'XL'],
                specifications: '13% акрил, 24% полиэстер, 45% шерсть, 16% эластан',
                price:4000,
                hit: false,
                type: 'w',
                favorite: false
            },
            {
                id: 2,
                article: 102565,
                name: 'Женская кофта 2',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/209/454_700_2/BAS-10104_209_20.jpg?cdn=1630044436',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/209/454_700_2/BAS-10104_209_20.jpg?cdn=1630044436', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/209/454_700_2/BAS-10104_209_20.jpg?cdn=1630044436', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/209/454_700_2/BAS-10104_209_20.jpg?cdn=1630044436'],
                colors:[{id: 1, color: '000'}, {id:2, color: 'fff'}, {id:3, color: 'ff0000'}, {id:4, color:'808080'}],
                sizes: ['M', 'S'],
                specifications: '60% акрил, 24% полиэстер, 65% шерсть, 56% эластан',
                price:2000,
                hit: true,
                type: 'w',
                favorite: false
            },
            {
                id: 5,
                article: 136412,
                name: 'Женская кофта 5',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/814/454_700_2/BAS-10105_814_20.jpg?cdn=1627369501',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/814/454_700_2/BAS-10105_814_20.jpg?cdn=1627369501', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/814/454_700_2/BAS-10105_814_20.jpg?cdn=1627369501', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/814/454_700_2/BAS-10105_814_20.jpg?cdn=1627369501'],
                colors:[{id: 5, color: '000'}, {id:6, color: 'ff0000'}],
                sizes: ['X'],
                specifications: '32% акрил, 29% полиэстер, 54% шерсть, 4% эластан',
                price:5000,
                hit: false,
                type: 'w',
                favorite: false
            },


            {
                id: 38,
                article: 101335,
                name: 'Пуховик с капюшоном',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/FWB/200/420_610_2/FWB61028_200_20.jpg?cdn=1638454832',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/FWB/200/420_610_2/FWB61028_200_20.jpg?cdn=1638454832', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FWB/200/420_610_2/FWB61028_200_20.jpg?cdn=1638454832', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FWB/200/420_610_2/FWB61028_200_20.jpg?cdn=1638454832'],
                colors:[{id: 30, color: '000'}, {id:17, color: 'fff'}, {id:66, color: 'ff0000'}, {id:45, color:'808080'}],
                sizes: ['XL', 'L', 'S'],
                specifications: '62% акрил, 86% полиэстер, 33% шерсть, 4% эластан',
                price:9000,
                hit: true,
                type: 'm',
                favorite: false
            },
            {
                id: 17,
                article: 132561,
                name: 'Утепленный мужской жилет с капюшоном',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/101/420_610_2/FAB210101_101_20.jpg?cdn=1635862084',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/101/420_610_2/FAB210101_101_20.jpg?cdn=1635862084', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/101/420_610_2/FAB210101_101_20.jpg?cdn=1635862084', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/101/420_610_2/FAB210101_101_20.jpg?cdn=1635862084'],
                colors:[{id: 30, color: '000'}, {id:17, color: 'fff'}, {id:66, color: 'ff0000'}, {id:45, color:'808080'}],
                sizes: ['M', 'L', 'S', 'XL'],
                specifications: '38% акрил, 24% полиэстер, 15% шерсть, 14% эластан',
                price:10000,
                hit: false,
                type: 'm',
                favorite: false
            },
            {
                id: 66,
                article: 442832,
                name: 'Кожаная мужская куртка-косуха свободного кроя',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/200/420_610_2/FAB21803_200_20.jpg?cdn=1637757381',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/200/420_610_2/FAB21803_200_20.jpg?cdn=1637757381', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/200/420_610_2/FAB21803_200_20.jpg?cdn=1637757381', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/200/420_610_2/FAB21803_200_20.jpg?cdn=1637757381'],
                colors:[{id: 30, color: '000'}, {id:66, color: 'ff0000'}],
                sizes: ['M', 'L', 'S'],
                specifications: '36% акрил, 2% полиэстер, 79% шерсть, 4% эластан',
                price:16000,
                hit: true,
                type: 'm',
                favorite: false
            },
            {
                id: 45,
                article: 154123,
                name: 'Куртка мужская',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/900/420_610_2/FAB21046_900_20.jpg?cdn=1632899522',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/900/420_610_2/FAB21046_900_20.jpg?cdn=1632899522', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/900/420_610_2/FAB21046_900_20.jpg?cdn=1632899522', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/900/420_610_2/FAB21046_900_20.jpg?cdn=1632899522'],
                colors:[{id: 30, color: '000'}, {id:17, color: 'fff'}, {id:66, color: 'ff0000'}, {id:45, color:'808080'}],
                sizes: ['L', 'XL'],
                specifications: '13% акрил, 24% полиэстер, 45% шерсть, 16% эластан',
                price:14000,
                hit: false,
                type: 'm',
                favorite: false
            },
            {
                id: 23,
                article: 17587,
                name: 'Oversize мужская куртка из искусственного меха',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/146/420_610_2/FAB210103_146_20.jpg?cdn=1639036567',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/146/420_610_2/FAB210103_146_20.jpg?cdn=1639036567', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/146/420_610_2/FAB210103_146_20.jpg?cdn=1639036567', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/146/420_610_2/FAB210103_146_20.jpg?cdn=1639036567'],
                colors:[{id: 30, color: '000'}, {id:17, color: 'fff'}, {id:66, color: 'ff0000'}, {id:45, color:'808080'}],
                sizes: ['M', 'S'],
                specifications: '60% акрил, 24% полиэстер, 65% шерсть, 56% эластан',
                price:12000,
                hit: true,
                type: 'm',
                favorite: false
            },
            {
                id: 51,
                article: 136126,
                name: 'Жилет мужской',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/608/420_610_2/FAB21009_608_20.jpg?cdn=1635862074',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/608/420_610_2/FAB21009_608_20.jpg?cdn=1635862074', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/608/420_610_2/FAB21009_608_20.jpg?cdn=1635862074', 'https://cdn.finnflare.com/upload/resize_cache/full_size/FAB/608/420_610_2/FAB21009_608_20.jpg?cdn=1635862074'],
                colors:[{id: 30, color: '000'}],
                sizes: ['X', 'XL', 'XXL'],
                specifications: '32% акрил, 29% полиэстер, 54% шерсть, 4% эластан',
                price:15000,
                hit: false,
                type: 'm',
                favorite: false
            },
        ],
        mainSlider: [
            {
                link: '',
                url: 'https://cdn.finnflare.com/upload/rk/206/FF_1920x600yut50.jpg?cdn=1638886995'
            },
            {
                link: '',
                url: 'https://cdn.finnflare.com/upload/rk/a9c/1920x600hat500612.jpg?cdn=1638886995'
            },
            {
                link: '',
                url: 'https://cdn.finnflare.com/upload/rk/33d/1920x600mrfdec.jpg?cdn=1638886995'
            },
        ],
        totalCount: 0,
        totalPrice: 0,
        store: {'card':[]},
        arrToBuy: [],
        props: {},
        filterColor: null,
        filterSize: null,
        filterMin: null,
        filterMax: null,
        sorting: '',
        totalFilter:[],
        hits:[],
        favorites: []
    },
    mutations: {
        totalCount(state, payload) {
            state.totalCount += payload;
            state.store['count'] = state.totalCount;
        },
        totalPrice(state, payload) {
            state.totalPrice += +payload;
            state.store['total'] = state.totalPrice;
        },
        addStore(state, payload) {
            if (state.store.card.length) {
                let x = false;
                let key = null;
                for (let i = 0; i < state.store.card.length; i++) {
                    if (state.store.card[i].id === payload.id && state.store.card[i].size === payload.size) {
                        x = true;
                        key = i;
                        break;
                    }
                }

                if (x) {
                    state.store.card[key].buy += 1;
                } else {
                    state.store.card.push({
                        id: payload.id,
                        img: payload.img,
                        name: payload.name,
                        price: payload.price,
                        size: payload.size,
                        buy: 1
                    });
                }
            } else {
                state.store.card.push({
                    id: payload.id,
                    img: payload.img,
                    name: payload.name,
                    price: payload.price,
                    size: payload.size,
                    buy: 1
                });
            }
            state.arrToBuy = state.store.card;
        },
        removeStore(state, payload) {
            let mass = state.store.card.filter(el => el.id === payload.id);
            if (state.store.card.length && mass.length) {
                state.store.card.forEach((item, key) => {
                    if (item.id === payload ){
                        item.buy -= 1;
                        if (item.buy < 1) {
                            state.store.card.splice(key, 1);
                        }
                    }
                })
            }
            state.arrToBuy = state.store.card;
        },
        remoteBasket(state, payload) {
            let mass = state.arrToBuy.filter(el => el.id === payload);
            if (state.arrToBuy.length && mass.length) {
                state.arrToBuy.forEach((item, key) => {
                    if (item.id === payload ){
                        item.buy -= 1;
                        if (item.buy < 1) {
                            state.arrToBuy.splice(key, 1);
                        }
                    }
                })
            }
            state.arrToBuy = state.store.card;
        },
        addLocalStorage(state) {
            localStorage.setItem('myProduct', JSON.stringify(state.store))
        },
        addSortLocalStorage(state) {
            localStorage.setItem('myCatalogSort', JSON.stringify(state.sorting))
        },
        clearBasket(state) {
            state.arrToBuy = [];
        },
        changeCount(state, payload) {
            const {id, count} = payload;
            state.arrToBuy.filter(item => {
                if (item.id === id) {
                    item.buy = count;
                }
            });
        },
        recalculation(state) {
            state.totalCount = 0;
            state.totalPrice = 0;
            state.arrToBuy.map(el => {
                state.totalCount += +el.buy;
                state.totalPrice += +el.buy * el.price;
            });
            state.store['count'] = state.totalCount;
            state.store['total'] = state.totalPrice;
        },
        removeProduct(state, payload) {
            state.arrToBuy.map((todo, key) => {
                if (key === payload) {
                    state.arrToBuy.splice(payload, 1);
                }
            })
            state.store.card.map((el, key) => {
                if (key === payload) {
                    state.store.card.splice(payload, 1);
                }
            })
        },
        property(state) {
            const color = [];
            const price = [];
            const size = [];
            const hits = [];
            const man = [];
            const woman = [];
            state.products.map(item => {
                item.colors.forEach(el => {
                    color.push(el.color);
                });

                item.sizes.forEach(el => {
                    size.push(el)
                })

                if (item.hit) {
                    hits.push(item)
                }

                if (item.type === 'm') {
                    man.push(item)
                } else {
                    woman.push(item)
                }

                price.push(item.price);
            });

            const min = price.sort().shift();
            const max = price.sort(function (a, b) {
                return b - a;
            });


            state.props['color'] = [...new Set(color)];
            state.props['price'] = [min, max[0]];
            state.props['size'] = [...new Set(size)];
            state.props['hits'] = [...new Set(hits)];
            state.props['m'] = [...new Set(man)];
            state.props['w'] = [...new Set(woman)];
        },
        filterSearch(state, payload) {
            const arr = [];
            state.products.forEach(prod => {
                prod.colors.forEach(item => {
                    payload.forEach(el => {
                        if (item.color == el) {
                            arr.push(el)
                        }
                    })
                })
            });
            state.filterColor = [...new Set(arr)];
        },
        filterSearchSize(state, payload) {
            const arr = [];
            state.products.forEach(prod => {
                prod.sizes.forEach(item => {
                    payload.forEach(el => {
                        if (item == el) {
                            arr.push(el)
                        }
                    })
                })
            });
            state.filterSize = [...new Set(arr)];
        },
        filterMin(state, payload) {
            state.filterMin = payload;
        },
        filterMax(state, payload) {
            state.filterMax = payload;
        },
        sortingType(state, payload) {
            state.sorting = payload;
        },
        sortingProduct(state, payload){
            if (state.totalFilter.length > 0) {
                sort(state.totalFilter)
            } else {
                sort(state.props.w)
                sort(state.props.m)
            }

            function sort(arr) {
                return payload === 'priceUp' ? arr.sort((a, b) => a.price - b.price) : arr.sort((a, b) => b.price - a.price)
            }
        },
        filterResult(state, payload) {
            let result = null;

            const filterProducts = array => {
                result = array.filter(product => {
                    if (product.price >= (+state.filterMin || +state.props.price[0]) && product.price <= (+state.filterMax || +state.props.price[1])) {
                        return product
                    }
                })
                    .filter(product => {
                        let test = null;
                        product.colors.filter(item => {
                            if (state.filterColor != null && state.filterColor.length > 0) {
                                return state.filterColor.filter(el => {
                                    if (el === item.color) {
                                        test = product
                                    }
                                })
                            }
                            return test = product
                        })
                        return test;
                    })
                    .filter(product => {
                        let test = null;
                        product.sizes.filter(item => {
                            if (state.filterSize != null && state.filterSize.length > 0) {
                               return state.filterSize.filter(el => {
                                   if (el === item) {
                                       test = product
                                   }
                               })
                            }
                            return test = product
                        })
                        return test;
                    })

                state.totalFilter = result.length > 0 ? [...new Set(result)] : [];
            }

            if (payload === 'm') {
                filterProducts(state.props.m)
            } else if (payload === 'w'){
                filterProducts(state.props.w)
            }
        },
        filterClear(state, payload){
            state.totalFilter = payload;
            const parsedUrl = new URL(window.location.href)
            if (parsedUrl.searchParams.get('min')){
                parsedUrl.searchParams.delete('min')
                parsedUrl.searchParams.delete('max')
                parsedUrl.searchParams.delete('colors')
                parsedUrl.searchParams.delete('sizes')
                state.filterColor = null;
                state.filterSize = null;
                state.filterMin = null;
                state.filterMax = null;
                window.history.pushState(null, null, parsedUrl)
            }
        },
        addFavorite(state, payload){
            if (state.favorites.length > 0 &&
                state.favorites.indexOf(payload) !== -1) {
                for (let i = 0; i <= state.favorites.length; i++) {
                    if (state.favorites[i] === payload) {
                        state.favorites.splice(i, 1);
                    }
                }
            } else {
                state.favorites.push(payload);
            }
            localStorage.setItem('myFavorites', JSON.stringify(state.favorites))
        }
    },
    actions: {
        addBasket(state, payload) {
            const item = state.state.products.find(item => item.id === payload.id);
            state.commit('totalCount', payload.count);
            state.commit('totalPrice', item.price);
            state.commit('addStore', {
                id: item.id,
                img: item.img,
                name: item.name,
                price: item.price,
                size: payload.sizes,
                buy: 1
            });
            state.commit('addLocalStorage', item)
        },
        remoteBasket(state, payload) {
            const item = state.state.products.find(item => item.id === payload.id);
            const { id, count } = payload;
            state.commit('remoteBasket', id);
            state.commit('totalCount', -count);
            state.commit('totalPrice', -item.price);
            state.commit('removeStore', id);
            state.commit('addLocalStorage', item);
        },
        clearBasket(state) {
            state.commit('clearBasket');
            localStorage.clear();
        },
        changeCount(state, payload) {
            state.commit('changeCount', payload);
            state.commit('recalculation');
            state.commit('addLocalStorage');
        },
        removeProduct(state, payload) {
            state.commit('removeProduct', payload);
            state.commit('recalculation');
            state.commit('addLocalStorage');
        },
        property(state) {
            state.commit('property');
        },
        filterSearch(state, payload) {
            state.commit('filterSearch', payload)
        },
        filterSearchSize(state, payload) {
            state.commit('filterSearchSize', payload)
        },
        filterMin(state, payload) {
            state.commit('filterMin',payload)
        },
        filterMax(state, payload) {
            state.commit('filterMax',payload)
        },
        sorting(state, payload) {
            state.commit('sortingProduct', payload)
            state.commit('sortingType', payload)
            // state.commit('addSortLocalStorage', payload)
        },
        filterResult(state, payload) {
            state.commit('filterResult', payload)
        },
        filterClear(state, payload) {
            state.commit('filterClear', payload);
        },
        addFavorite(state, payload){
            state.commit('addFavorite', payload)
        }
    },
    getters: {
        products: state => state.products,
        mainSlider: state => state.mainSlider,
        productDetailID(state) {
            return productId => {
                return state.products.find(product => product.id === +productId)
            }
        },
        totalCount: state => state.totalCount,
        totalPrice: state => state.totalPrice,
        arrToBuy: state => state.arrToBuy,
        property: state => state.props,
        filterSearch: state => state.filterColor,
        filterResultMan: state => state.totalFilter.length > 0 ? state.totalFilter : state.props.m,
        filterResultWoman: state => state.totalFilter.length > 0 ? state.totalFilter : state.props.w,
        sorting: state => state.sorting,
        filterMin: state => state.filterMin,
        filterMax: state => state.filterMax,
        filterColor: state => state.filterColor,
        filterSize: state => state.filterSize,
        hits: state => state.props.hits,
        sliderMan: state => state.props.m,
        sliderWoman: state => state.props.w,
        addFavorite: state => state.favorites,
        localStore(state) {
            if (localStorage.getItem('myProduct')) {
                state.totalCount = JSON.parse(localStorage.getItem('myProduct')).count;
                state.totalPrice = JSON.parse(localStorage.getItem('myProduct')).total;
                state.store.card = JSON.parse(localStorage.getItem('myProduct')).card;
                state.arrToBuy = JSON.parse(localStorage.getItem('myProduct')).card;
            }
            if (localStorage.getItem('myFavorites')) {
                state.favorites = JSON.parse(localStorage.getItem('myFavorites'));
            }
            if (localStorage.getItem('myCatalogSort')) {
                state.sorting = JSON.parse(localStorage.getItem('myCatalogSort'));
            }
            const parsedUrl = new URL(window.location.href)
            if (parsedUrl.searchParams.get('min')) {
                state.filterColor = parsedUrl.searchParams.get('colors').length ? parsedUrl.searchParams.get('colors').split(',') : '';
                state.filterSize = parsedUrl.searchParams.get('sizes').length ? parsedUrl.searchParams.get('sizes').split(',') : '';
                state.filterMin = +parsedUrl.searchParams.get('min');
                state.filterMax = +parsedUrl.searchParams.get('max');
            }
        }
    }
}