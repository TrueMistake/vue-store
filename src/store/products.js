export default {
    state: {
        products: [
            {
                id: 3,
                article: 102935,
                name: 'Женская кофта 3',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/300/454_700_2/BAS-10105_300_20.jpg?cdn=1627901282',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/300/454_700_2/BAS-10105_300_20.jpg?cdn=1627901282', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/300/454_700_2/BAS-10105_300_20.jpg?cdn=1627901282', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/300/454_700_2/BAS-10105_300_20.jpg?cdn=1627901282'],
                colors:[{id: 1, color: '#000'}, {id:2, color: '#fff'}, {id:3, color: '#ff0000'}, {id:4, color:'#808080'}],
                sizes: ['XL', 'L', 'S'],
                specifications: '62% акрил, 86% полиэстер, 33% шерсть, 4% эластан',
                price:3000
            },
            {
                id: 1,
                article: 102561,
                name: 'Женская кофта 1',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/101/454_700_2/BAS-10104_101_20.jpg?cdn=1627393262',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/101/454_700_2/BAS-10104_101_20.jpg?cdn=1627393262', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/101/454_700_2/BAS-10104_101_20.jpg?cdn=1627393262', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/101/454_700_2/BAS-10104_101_20.jpg?cdn=1627393262'],
                colors:[{id: 1, color: '#000'}, {id:2, color: '#fff'}, {id:3, color: '#ff0000'}, {id:4, color:'#808080'}],
                sizes: ['M', 'L', 'S', 'XL'],
                specifications: '38% акрил, 24% полиэстер, 15% шерсть, 14% эластан',
                price:1000
            },
            {
                id: 6,
                article: 984232,
                name: 'Женская кофта 6',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/409/454_700_2/BAS-10106_409_20.jpg?cdn=1627369501',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/409/454_700_2/BAS-10106_409_20.jpg?cdn=1627369501', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/409/454_700_2/BAS-10106_409_20.jpg?cdn=1627369501', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/409/454_700_2/BAS-10106_409_20.jpg?cdn=1627369501'],
                colors:[{id: 5, color: '#000'}, {id:6, color: '#ff0000'}],
                sizes: ['M', 'L', 'S'],
                specifications: '36% акрил, 2% полиэстер, 79% шерсть, 4% эластан',
                price:6000
            },
            {
                id: 4,
                article: 102123,
                name: 'Женская кофта 4',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/211/454_700_2/BAS-10105_211_20.jpg?cdn=1627393262',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/211/454_700_2/BAS-10105_211_20.jpg?cdn=1627393262', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/211/454_700_2/BAS-10105_211_20.jpg?cdn=1627393262', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/211/454_700_2/BAS-10105_211_20.jpg?cdn=1627393262'],
                colors:[{id: 1, color: '#000'}, {id:2, color: '#fff'}, {id:3, color: '#ff0000'}, {id:4, color:'#808080'}],
                sizes: ['L', 'XL'],
                specifications: '13% акрил, 24% полиэстер, 45% шерсть, 16% эластан',
                price:4000
            },
            {
                id: 2,
                article: 102565,
                name: 'Женская кофта 2',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/209/454_700_2/BAS-10104_209_20.jpg?cdn=1630044436',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/209/454_700_2/BAS-10104_209_20.jpg?cdn=1630044436', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/209/454_700_2/BAS-10104_209_20.jpg?cdn=1630044436', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/209/454_700_2/BAS-10104_209_20.jpg?cdn=1630044436'],
                colors:[{id: 1, color: '#000'}, {id:2, color: '#fff'}, {id:3, color: '#ff0000'}, {id:4, color:'#808080'}],
                sizes: ['M', 'S'],
                specifications: '60% акрил, 24% полиэстер, 65% шерсть, 56% эластан',
                price:2000
            },
            {
                id: 5,
                article: 136412,
                name: 'Женская кофта 5',
                img:'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/814/454_700_2/BAS-10105_814_20.jpg?cdn=1627369501',
                imgOther: ['https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/814/454_700_2/BAS-10105_814_20.jpg?cdn=1627369501', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/814/454_700_2/BAS-10105_814_20.jpg?cdn=1627369501', 'https://cdn.finnflare.com/upload/resize_cache/full_size/BAS/814/454_700_2/BAS-10105_814_20.jpg?cdn=1627369501'],
                colors:[{id: 5, color: '#000'}, {id:6, color: '#ff0000'}],
                sizes: ['X', 'XL', 'XXL'],
                specifications: '32% акрил, 29% полиэстер, 54% шерсть, 4% эластан',
                price:5000
            },

        ],
        mainSlider: [
            {
                link: '',
                url: 'https://cdn.finnflare.com/upload/rk/206/FF_1920x600yut50.jpg?cdn=1638886995'
            },
            {
                link: '',
                url: 'https://cdn.finnflare.com/upload/rk/a9c/1920x600hat500612.jpg?cdn=1638886995'
            },
            {
                link: '',
                url: 'https://cdn.finnflare.com/upload/rk/33d/1920x600mrfdec.jpg?cdn=1638886995'
            },
        ],
        totalCount: 0,
        totalPrice: 0,
        store: {'card':[]},
        arrToBuy: [],
        props: {},
        filterColor: null,
        filterSize: null,
        filterMin: null,
        filterMax: null,
        sorting: '',
        totalFilter:[]
    },
    mutations: {
        totalCount(state, payload) {
            state.totalCount += payload;
            state.store['count'] = state.totalCount;
        },
        totalPrice(state, payload) {
            state.totalPrice += +payload;
            state.store['total'] = state.totalPrice;
        },
        addStore(state, payload) {
            let mass = state.store.card.filter(el => el.id === payload.id);
            if (state.store.card.length && mass.length) {
                for (let i = 0; i < state.store.card.length; i++) {
                    if (state.store.card[i].id === payload.id ){
                        state.store.card[i].buy += 1;
                    }
                }
            } else {
                state.store.card.push({
                    id: payload.id,
                    img: payload.img,
                    name: payload.name,
                    price: payload.price,
                    buy: 1
                });
            }
            state.arrToBuy = state.store.card;
        },
        removeStore(state, payload) {
            let mass = state.store.card.filter(el => el.id === payload.id);
            if (state.store.card.length && mass.length) {
                state.store.card.forEach((item, key) => {
                    if (item.id === payload ){
                        item.buy -= 1;
                        if (item.buy < 1) {
                            state.store.card.splice(key, 1);
                        }
                    }
                })
            }
            state.arrToBuy = state.store.card;
        },
        remoteBasket(state, payload) {
            let mass = state.arrToBuy.filter(el => el.id === payload);
            if (state.arrToBuy.length && mass.length) {
                state.arrToBuy.forEach((item, key) => {
                    if (item.id === payload ){
                        item.buy -= 1;
                        if (item.buy < 1) {
                            state.arrToBuy.splice(key, 1);
                        }
                    }
                })
            }
            state.arrToBuy = state.store.card;
        },
        addLocalStorage(state) {
            localStorage.setItem('myProduct', JSON.stringify(state.store))
        },
        addSortLocalStorage(state) {
            localStorage.setItem('myCatalogSort', JSON.stringify(state.sorting))
        },
        clearBasket(state) {
            state.arrToBuy = [];
        },
        changeCount(state, payload) {
            const {id, count} = payload;
            state.arrToBuy.filter(item => {
                if (item.id === id) {
                    item.buy = count;
                }
            });
        },
        recalculation(state) {
            state.totalCount = 0;
            state.totalPrice = 0;
            state.arrToBuy.map(el => {
                state.totalCount += +el.buy;
                state.totalPrice += +el.buy * el.price;
            });
            state.store['count'] = state.totalCount;
            state.store['total'] = state.totalPrice;
        },
        removeProduct(state, payload) {
            state.arrToBuy.map((todo, key) => {
                if (key === payload) {
                    state.arrToBuy.splice(payload, 1);
                }
            })
            state.store.card.map((el, key) => {
                if (key === payload) {
                    state.store.card.splice(payload, 1);
                }
            })
        },
        property(state) {
            const color = [];
            const price = [];
            const size = [];
            state.products.map(item => {
                item.colors.forEach(el => {
                    color.push(el.color);
                });
                item.sizes.forEach(el => {
                    size.push(el)
                })
                price.push(item.price);
            });

            const min = price.sort().shift();
            const max = price.sort().pop();

            state.props['color'] = [...new Set(color)];
            state.props['price'] = [min, max];
            state.props['size'] = [...new Set(size)];
        },
        filterSearch(state, payload) {
            const arr = [];
            state.products.forEach(prod => {
                prod.colors.forEach(item => {
                    payload.forEach(el => {
                        if (item.color == el) {
                            arr.push(el)
                        }
                    })
                })
            });
            state.filterColor = [...new Set(arr)];
        },
        filterSearchSize(state, payload) {
            const arr = [];
            state.products.forEach(prod => {
                prod.sizes.forEach(item => {
                    payload.forEach(el => {
                        if (item == el) {
                            arr.push(el)
                        }
                    })
                })
            });
            state.filterSize = [...new Set(arr)];
        },
        filterMin(state, payload) {
            state.filterMin = payload;
        },
        filterMax(state, payload) {
            state.filterMax = payload;
        },
        sortingType(state, payload) {
            state.sorting = payload;
        },
        sortingProduct(state, payload){
            if (state.totalFilter.length > 0) {
                if (payload == 'priceUp') {
                    state.totalFilter.sort(function (a, b) {
                        return a.price - b.price;
                    });
                    state.totalFilter = state.products;
                } else if (payload == 'priceDown'){
                    state.totalFilter.sort(function (a, b) {
                        return b.price - a.price;
                    });
                    state.totalFilter = state.products;
                }
            } else {
                if (payload == 'priceUp') {
                    state.products.sort(function (a, b) {
                        return a.price - b.price;
                    });
                    state.totalFilter = state.products;
                } else if (payload == 'priceDown'){
                    state.products.sort(function (a, b) {
                        return b.price - a.price;
                    });
                    state.totalFilter = state.products;
                }
            }
        },
        filterResult(state) {
            const color = [];
            const size = [];
            const price = [];
            let result = [];
            state.products.filter(product => {
                product.colors.filter(item => {
                    if (state.filterColor != null) {
                        state.filterColor.filter(el => {
                            if (el === item.color) {
                                color.push(product)
                            }
                        })
                    }
                })

                product.sizes.filter(item => {
                    if (state.filterSize != null) {
                        state.filterSize.filter(el => {
                            if (el === item) {
                                size.push(product)
                            }
                        })
                    }
                })
            })

            if (state.props.price[0] != state.filterMin || state.props.price[1] != state.filterMax) {
                state.products.filter(product => {
                    if (product.price >= +state.filterMin && product.price <= +state.filterMax) {
                        price.push(product)
                    }
                })
            }

            if (color.length > 0 && size.length > 0 && price.length > 0) {
                const prop = color.filter(item => size.indexOf(item) !== -1);
                result = prop.filter(item => price.indexOf(item) !== -1);
                return state.totalFilter = result.length > 0 ? [...new Set(result)] : state.products;
            }else if (color.length > 0 && size.length > 0) {
                result = color.filter(item => size.indexOf(item) !== -1);
                return state.totalFilter = result.length > 0 ? [...new Set(result)] : state.products;
            } else if (color.length > 0 && price.length > 0) {
                result = color.filter(item => price.indexOf(item) !== -1);
                return state.totalFilter = result.length > 0 ? [...new Set(result)] : state.products;
            } else if (size.length > 0 && price.length > 0) {
                result = size.filter(item => price.indexOf(item) !== -1);
                return state.totalFilter = result.length > 0 ? [...new Set(result)] : state.products;
            } else if (color.length > 0) {
                return state.totalFilter = color;
            } else if (size.length > 0) {
                return state.totalFilter = size;
            } else if (price.length > 0) {
                return state.totalFilter = price;
            } else {
                return state.totalFilter = state.products;
            }
        },
        filterClear(state, payload){
            state.totalFilter = payload
        }
    },
    actions: {
        addBasket(state, payload) {
            const item = state.state.products.find(item => item.id === payload.id);
            state.commit('totalCount', payload.count);
            state.commit('totalPrice', item.price);
            state.commit('addStore', {
                id: item.id,
                img: item.img,
                name: item.name,
                price: item.price,
                buy: 1
            });
            state.commit('addLocalStorage', item)
        },
        remoteBasket(state, payload) {
            const item = state.state.products.find(item => item.id === payload.id);
            const { id, count } = payload;
            state.commit('remoteBasket', id);
            state.commit('totalCount', -count);
            state.commit('totalPrice', -item.price);
            state.commit('removeStore', id);
            state.commit('addLocalStorage', item);
        },
        clearBasket(state) {
            state.commit('clearBasket');
            localStorage.clear();
        },
        changeCount(state, payload) {
            state.commit('changeCount', payload);
            state.commit('recalculation');
            state.commit('addLocalStorage');
        },
        removeProduct(state, payload) {
            state.commit('removeProduct', payload);
            state.commit('recalculation');
            state.commit('addLocalStorage');
        },
        property(state) {
            state.commit('property');
        },
        filterSearch(state, payload) {
            state.commit('filterSearch', payload)
        },
        filterSearchSize(state, payload) {
            state.commit('filterSearchSize', payload)
        },
        filterMin(state, payload) {
            state.commit('filterMin',payload)
        },
        filterMax(state, payload) {
            state.commit('filterMax',payload)
        },
        sorting(state, payload) {
            state.commit('sortingProduct', payload)
            state.commit('sortingType', payload)
            state.commit('addSortLocalStorage', payload)
        },
        filterResult(state) {
            state.commit('filterResult')
        },
        filterClear(state, payload) {
            state.commit('filterClear', payload)
        }
    },
    getters: {
        products: state => state.products,
        mainSlider: state => state.mainSlider,
        productDetailID(state) {
            return productId => {
                return state.products.find(product => product.id === +productId)
            }
        },
        totalCount: state => state.totalCount,
        totalPrice: state => state.totalPrice,
        arrToBuy: state => state.arrToBuy,
        property: state => state.props,
        filterSearch: state => state.filterColor,
        filterResult: state => state.totalFilter.length > 0 ? state.totalFilter : state.products,
        sorting: state => state.sorting,
        localStore(state) {
            if (localStorage.getItem('myProduct')) {
                state.totalCount = JSON.parse(localStorage.getItem('myProduct')).count;
                state.totalPrice = JSON.parse(localStorage.getItem('myProduct')).total;
                state.store.card = JSON.parse(localStorage.getItem('myProduct')).card;
                state.arrToBuy = JSON.parse(localStorage.getItem('myProduct')).card;
            }
            /*if (localStorage.getItem('myCatalogSort')) {
                state.sorting = JSON.parse(localStorage.getItem('myCatalogSort')).sorting;
            }*/
        }
    }
}